---
title: "Output options"
subtitle: "Get different kinds of output from OpenCage"
author: "Daniel Possenriede, Jesse Sadler, MaÃ«lle Salmon"
date: "2020-10-07"
description: >
  "`oc_forward()`/`oc_reverse()` return lists of various type, namely data frames, JSON, GeoJSON or URLs, depending on the `return` value you specify. The possible `return` values are `df_list`, `json_list`, `geojson_list` and `url_only`."
output: 
  rmarkdown::html_vignette:
    df_print: kable
vignette: >
  %\VignetteIndexEntry{Output options}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



{opencage} contains two types of main functions. 

1. The `oc_forward_df()`/`oc_reverse_df()` functions, which always return a single tibble.
2. The `oc_forward()`/`oc_reverse()` functions, which return lists of various types, depending on the `return` value you specify. The possible `return` values are `df_list`, `json_list`, `geojson_list` and `url_only`.

We have shown the `oc_forward_df()`/`oc_reverse_df()` functions in the [Introduction to opencage](intro_opencage.html) and the [Customise your query](customise_query.html) vignettes. 
The function arguments mentioned in the other vignettes are also available with `oc_forward()`/`oc_reverse()`, in general.
Here we will show the different return values available with `oc_forward()`/`oc_reverse()`. 

## `df_list`

The default return value is `df_list`. 
It returns a list of tibbles.  


```r
oc_forward("Casey Station", return = "df_list")
#> [[1]]
#> # A tibble: 1 x 12
#>   oc_confidence oc_formatted oc_northeast_lat oc_northeast_lng oc_southwest_lat oc_southwest_lng oc_category oc_type
#>           <int> <chr>                   <dbl>            <dbl>            <dbl>            <dbl> <chr>       <chr>  
#> 1             7 Casey Stati~            -66.3             111.            -66.3             111. place       village
#> # ... with 4 more variables: oc_continent <chr>, oc_hamlet <chr>, oc_lat <dbl>, oc_lng <dbl>
```

The `df_list` type drives the `oc_forward_df()`/`oc_reverse_df()` functions.
If you want to use opencage in a `dplyr::mutate()` chain you can do it like this:


```r
library(dplyr, warn.conflicts = FALSE)

oc_data <- 
  tibble(place = "Casey Station") %>% 
  mutate(oc_result = oc_forward(place))

oc_data
#> # A tibble: 1 x 2
#>   place         oc_result        
#>   <chr>         <list>           
#> 1 Casey Station <tibble [1 x 12]>
```

This creates the list column `oc_result`, which can be easily unnested with `tidyr::unnest()`


```r
library(tidyr, warn.conflicts = FALSE)

oc_data %>% unnest(oc_result)
#> # A tibble: 1 x 13
#>   place oc_confidence oc_formatted oc_northeast_lat oc_northeast_lng oc_southwest_lat oc_southwest_lng oc_category oc_type
#>   <chr>         <int> <chr>                   <dbl>            <dbl>            <dbl>            <dbl> <chr>       <chr>  
#> 1 Case~             7 Casey Stati~            -66.3             111.            -66.3             111. place       village
#> # ... with 4 more variables: oc_continent <chr>, oc_hamlet <chr>, oc_lat <dbl>, oc_lng <dbl>
```

## `json_list`

OpenCage's main output format is JSON. When you specify `json_list` as the return type, you get the JSON as an R `list()`. 


```r
oc_forward("Casey Station", return = "json_list")
#> [[1]]
#> [[1]]$documentation
#> [1] "https://opencagedata.com/api"
#> 
#> [[1]]$licenses
#> [[1]]$licenses[[1]]
#> [[1]]$licenses[[1]]$name
#> [1] "see attribution guide"
#> 
#> [[1]]$licenses[[1]]$url
#> [1] "https://opencagedata.com/credits"
#> 
#> 
#> 
#> [[1]]$rate
#> [[1]]$rate$limit
#> [1] 2500
#> 
#> [[1]]$rate$remaining
#> [1] 2441
#> 
#> [[1]]$rate$reset
#> [1] 1602115200
#> 
#> 
#> [[1]]$results
#> [[1]]$results[[1]]
#> [[1]]$results[[1]]$bounds
#> [[1]]$results[[1]]$bounds$northeast
#> [[1]]$results[[1]]$bounds$northeast$lat
#> [1] -66.26249
#> 
#> [[1]]$results[[1]]$bounds$northeast$lng
#> [1] 110.5468
#> 
#> 
#> [[1]]$results[[1]]$bounds$southwest
#> [[1]]$results[[1]]$bounds$southwest$lat
#> [1] -66.30249
#> 
#> [[1]]$results[[1]]$bounds$southwest$lng
#> [1] 110.5068
#> 
#> 
#> 
#> [[1]]$results[[1]]$components
#> [[1]]$results[[1]]$components$`_category`
#> [1] "place"
#> 
#> [[1]]$results[[1]]$components$`_type`
#> [1] "village"
#> 
#> [[1]]$results[[1]]$components$continent
#> [1] "Antarctica"
#> 
#> [[1]]$results[[1]]$components$hamlet
#> [1] "Casey Station"
#> 
#> 
#> [[1]]$results[[1]]$confidence
#> [1] 7
#> 
#> [[1]]$results[[1]]$formatted
#> [1] "Casey Station"
#> 
#> [[1]]$results[[1]]$geometry
#> [[1]]$results[[1]]$geometry$lat
#> [1] -66.28249
#> 
#> [[1]]$results[[1]]$geometry$lng
#> [1] 110.5268
#> 
#> 
#> 
#> 
#> [[1]]$status
#> [[1]]$status$code
#> [1] 200
#> 
#> [[1]]$status$message
#> [1] "OK"
#> 
#> 
#> [[1]]$stay_informed
#> [[1]]$stay_informed$blog
#> [1] "https://blog.opencagedata.com"
#> 
#> [[1]]$stay_informed$twitter
#> [1] "https://twitter.com/OpenCage"
#> 
#> 
#> [[1]]$thanks
#> [1] "For using an OpenCage API"
#> 
#> [[1]]$timestamp
#> [[1]]$timestamp$created_http
#> [1] "Wed, 07 Oct 2020 07:12:44 GMT"
#> 
#> [[1]]$timestamp$created_unix
#> [1] 1602054764
#> 
#> 
#> [[1]]$total_results
#> [1] 1
```

## `geojson_list`

When you choose `geojson_list` as the return type, the geocoder response will be returned as GeoJSON specified as an R `list()`.


```r
gjsn_lst <- oc_forward("Casey Station", return = "geojson_list")
gjsn_lst
#> [[1]]
#> $documentation
#> [1] "https://opencagedata.com/api"
#> 
#> $features
#> $features[[1]]
#> $features[[1]]$geometry
#> $features[[1]]$geometry$coordinates
#> $features[[1]]$geometry$coordinates[[1]]
#> [1] 110.5268
#> 
#> $features[[1]]$geometry$coordinates[[2]]
#> [1] -66.28249
#> 
#> 
#> $features[[1]]$geometry$type
#> [1] "Point"
#> 
#> 
#> $features[[1]]$properties
#> $features[[1]]$properties$bounds
#> $features[[1]]$properties$bounds$northeast
#> $features[[1]]$properties$bounds$northeast$lat
#> [1] -66.26249
#> 
#> $features[[1]]$properties$bounds$northeast$lng
#> [1] 110.5468
#> 
#> 
#> $features[[1]]$properties$bounds$southwest
#> $features[[1]]$properties$bounds$southwest$lat
#> [1] -66.30249
#> 
#> $features[[1]]$properties$bounds$southwest$lng
#> [1] 110.5068
#> 
#> 
#> 
#> $features[[1]]$properties$components
#> $features[[1]]$properties$components$`_category`
#> [1] "place"
#> 
#> $features[[1]]$properties$components$`_type`
#> [1] "village"
#> 
#> $features[[1]]$properties$components$continent
#> [1] "Antarctica"
#> 
#> $features[[1]]$properties$components$hamlet
#> [1] "Casey Station"
#> 
#> 
#> $features[[1]]$properties$confidence
#> [1] 7
#> 
#> $features[[1]]$properties$formatted
#> [1] "Casey Station"
#> 
#> 
#> $features[[1]]$type
#> [1] "Feature"
#> 
#> 
#> 
#> $licenses
#> $licenses[[1]]
#> $licenses[[1]]$name
#> [1] "see attribution guide"
#> 
#> $licenses[[1]]$url
#> [1] "https://opencagedata.com/credits"
#> 
#> 
#> 
#> $rate
#> $rate$limit
#> [1] 2500
#> 
#> $rate$remaining
#> [1] 2429
#> 
#> $rate$reset
#> [1] 1602115200
#> 
#> 
#> $status
#> $status$code
#> [1] 200
#> 
#> $status$message
#> [1] "OK"
#> 
#> 
#> $stay_informed
#> $stay_informed$blog
#> [1] "https://blog.opencagedata.com"
#> 
#> $stay_informed$twitter
#> [1] "https://twitter.com/OpenCage"
#> 
#> 
#> $thanks
#> [1] "For using an OpenCage API"
#> 
#> $timestamp
#> $timestamp$created_http
#> [1] "Wed, 07 Oct 2020 07:12:46 GMT"
#> 
#> $timestamp$created_unix
#> [1] 1602054766
#> 
#> 
#> $total_results
#> [1] 1
#> 
#> $type
#> [1] "FeatureCollection"
#> 
#> attr(,"class")
#> [1] "geo_list"
```

In fact, {opencage} returns a list of results in `geo_list` format, which should be compatible with the {[geojsonio](https://docs.ropensci.org/geojsonio)} package.


```r
class(gjsn_lst[[1]])
#> [1] "geo_list"
```


## `url_only`

`url_only` will return the OpenCage URL for debugging purposes. 
We won't show the output here, because the URL contains the OpenCage API key. 


```r
oc_forward("Casey Station", return = "url_only")
```

## `xml`

{opencage} does not support the XML response type at the moment. 
Please file an [issue](https://github.com/ropensci/opencage/issues) if you have a use-case that requires this.

## Return query text

`oc_forward()` and `oc_reverse()` have an `add_request` argument, indicating whether the request is returned again with the results. 
If the `return` value is a `df_list`, the `placename` or `latitude,longitude` is added as a column to the results without a roundtrip to the API.
`json_list` results will contain all request parameters as returned by the API, including the API key used, so handle with care!
`add_request` is currently ignored by OpenCage for GeoJSON results.
